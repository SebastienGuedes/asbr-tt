<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accueil - ASBR-TT</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Menu charg√© depuis menu.html -->
  <div id="menu-placeholder"></div>

  <main>
    <!-- Pr√©sentation du club -->
    <section class="card presentation">
      <h1>Bienvenue au club !</h1>
      <p>
        60 ans d‚Äôhistoire, des dizaines de membres passionn√©s, et une seule mission :
        vous faire vibrer avec le tennis de table !
      </p>
      <p>
        N√© en 1956 comme section de l‚ÄôAmicale Sportive de Bosc Roger, le tennis de table a pris son ind√©pendance en 2023
        pour devenir l‚ÄôASBR-TT, une association dynamique ancr√©e dans la vie de Bosroumois.
      </p>
      <p>
        Aujourd‚Äôhui, le club rassemble jeunes et moins jeunes autour d‚Äôune m√™me passion,
        dans un esprit sportif o√π se m√™lent sant√©, √©quilibre, plaisir du jeu et performance.
      </p>
      <p>
        Que vous souhaitiez d√©couvrir le tennis de table, pratiquer pour le loisir
        ou vous engager en comp√©tition f√©d√©rale, nous sommes heureux de vous accueillir
        dans la convivialit√© et la bonne humeur !
      </p>
    </section>

    <!-- √âv√©nements -->
    <section class="card evenements">
      <h2>√âv√©nements √† venir</h2>
      <ul id="calendar-events">
        <li>Chargement des √©v√©nements...</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>¬© 2025 - ASBR-TT</p>
  </footer>

  <!-- Script pour charger le menu -->
  <script>
    fetch("menu.html")
      .then(res => res.text())
      .then(html => document.getElementById("menu-placeholder").innerHTML = html);
  </script>

  <!-- Script calendrier avec cache -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const calendarId = "TON_CALENDAR_ID"; // ‚Üê Mets ton ID de calendrier
    const apiKey = "TA_CLE_API";          // ‚Üê Mets ta cl√© API
    const maxResults = 10;
    const cacheKey = "calendarEvents";
    const cacheTTL = 60 * 60 * 1000; // 1h
    const list = document.getElementById("calendar-events");

    function renderEvents(events) {
      list.innerHTML = "";
      if (!events || events.length === 0) {
        list.innerHTML = "<li>Aucun √©v√©nement √† venir</li>";
        return;
      }
      events.forEach(ev => {
        let start;
        if (ev.start.dateTime) {
          start = new Date(ev.start.dateTime);
        } else if (ev.start.date) {
          start = new Date(ev.start.date);
        }
        const dateStr = start.toLocaleDateString("fr-FR", {
          weekday: 'short',
          day: 'numeric',
          month: 'short',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        const li = document.createElement("li");
        li.textContent = `${dateStr} ‚Äì ${ev.summary || "Sans titre"}`;
        list.appendChild(li);
      });
    }

    // V√©rifier le cache
    const cached = localStorage.getItem(cacheKey);
    if (cached) {
      const { timestamp, data } = JSON.parse(cached);
      if (Date.now() - timestamp < cacheTTL) {
        console.log("‚úÖ Donn√©es charg√©es depuis le cache");
        renderEvents(data.items);
        return;
      }
    }

    // Sinon ‚Üí appel API
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&orderBy=startTime&singleEvents=true&timeMin=${new Date().toISOString()}&maxResults=${maxResults}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        console.log("üì° Donn√©es charg√©es depuis l'API Google Calendar");
        localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));
        renderEvents(data.items);
      })
      .catch(err => {
        console.error("‚ùå Erreur API Google Calendar :", err);
        list.innerHTML = "<li>Impossible de charger les √©v√©nements.</li>";
      });
  });
  </script>
</body>
</html>
